package main

import (
	stdjson "encoding/json"
	"fmt"
	"github.com/beckjiang/go-json"
	"log"
)

func main() {

	fmt.Println("length: ", len(`000000000000000000000000000000000000000418160ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000530f579664e7eed282b0a3eb1fa9f2b30cb4f379000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac00000000000000000000000000000000000000000000000000000000000000000000000000000000530f579664e7eed282b0a3eb1fa9f2b30cb4f3790000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000053986bf318f90c775a9cb0e49a9849162876f199000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000053986bf318f90c775a9cb0e49a9849162876f1990000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000053f22927e168861608173d13f7c4af7a54d96626000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000053f22927e168861608173d13f7c4af7a54d966260000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005510b42b41df8e0be172ede5b9e0d7e7913ad4da000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005510b42b41df8e0be172ede5b9e0d7e7913ad4da0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000055f324d88c867113a23d1d1c79cf602b9b98b5f3000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000055f324d88c867113a23d1d1c79cf602b9b98b5f30000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000569d01770fd4185869e7a3edbc3220ceb6b8260c000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac00000000000000000000000000000000000000000000000000000000000000000000000000000000569d01770fd4185869e7a3edbc3220ceb6b8260c0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000058065f6ca40c000c71c110cec47fb57b7cc0b9b9000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000058065f6ca40c000c71c110cec47fb57b7cc0b9b90000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000058bcb3d7bc69b4f3d0d1eca1c7dcf7b4b2f1ebd4000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000058bcb3d7bc69b4f3d0d1eca1c7dcf7b4b2f1ebd40000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000058ceae1ca2cefae617ad73decaa6965f539a6fc2000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000058ceae1ca2cefae617ad73decaa6965f539a6fc20000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005a8f9bfdc9e9cba885517b9112b02dc34574722b000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005a8f9bfdc9e9cba885517b9112b02dc34574722b0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005b8682477b6d667bb81c89e0bb07c266d509e821000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005b8682477b6d667bb81c89e0bb07c266d509e8210000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005c5e99aad5a016fc033aef9736e8007cef76ae80000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005c5e99aad5a016fc033aef9736e8007cef76ae800000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005c6e0bc3028e3d6a0b7c1270b089fb35411b2088000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005c6e0bc3028e3d6a0b7c1270b089fb35411b20880000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005cf7b212a8367158ed59d97ee6a5f1a7506fa266000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005cf7b212a8367158ed59d97ee6a5f1a7506fa2660000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005d5bf510650673ecf7a2956f55fb1d4a7943a21f000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005d5bf510650673ecf7a2956f55fb1d4a7943a21f0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005d69a0e5e91d1e66459a76da2a4d8863e97cd90d000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005d69a0e5e91d1e66459a76da2a4d8863e97cd90d0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005db3fdec0fac36027c89ab57a3bc67af19df8ac3000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005db3fdec0fac36027c89ab57a3bc67af19df8ac30000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005dde043464b656da7acae145d655a03070087f66000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005dde043464b656da7acae145d655a03070087f660000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005f78f5da40316e814ff086394059dbde910251ba000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005f78f5da40316e814ff086394059dbde910251ba0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005f8bf822f682bd1d1598b7ee1de4c5851a58d186000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005f8bf822f682bd1d1598b7ee1de4c5851a58d1860000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd000000000000000000000000000000000000000000000000000000000000000000000000000000005f8c9091e355e2e08db789aeaa92f44fd37ade69000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac000000000000000000000000000000000000000000000000000000000000000000000000000000005f8c9091e355e2e08db789aeaa92f44fd37ade690000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000061bedfa60aebaab319a77ba9320450fee7b84957000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000061bedfa60aebaab319a77ba9320450fee7b849570000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000062216be28759d64b20ff31c5c0984f9677c1d624000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000062216be28759d64b20ff31c5c0984f9677c1d6240000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000626fddeb3351a9cfaf2f909395962194ae46315e000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac00000000000000000000000000000000000000000000000000000000000000000000000000000000626fddeb3351a9cfaf2f909395962194ae46315e0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000063054cc76e114ff075cd9736e26398268658d9e2000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000063054cc76e114ff075cd9736e26398268658d9e20000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000631f07b939685ac22fd163dc3fdd95e8c5afb7b5000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac00000000000000000000000000000000000000000000000000000000000000000000000000000000631f07b939685ac22fd163dc3fdd95e8c5afb7b50000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000063aa8c9bd961f1216a2d58a84120701d63a3831d000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000063aa8c9bd961f1216a2d58a84120701d63a3831d0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000064d7be937e01e3293d545de6bc68c86dc5e0a9b5000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000064d7be937e01e3293d545de6bc68c86dc5e0a9b50000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd0000000000000000000000000000000000000000000000000000000000000000000000000000000065319d4952c52171ea75770a79e23bf86f4664bc000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac0000000000000000000000000000000000000000000000000000000000000000000000000000000065319d4952c52171ea75770a79e23bf86f4664bc0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000662f3dd8ba206df627655c807c4605b5d89baa17000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac00000000000000000000000000000000000000000000000000000000000000000000000000000000662f3dd8ba206df627655c807c4605b5d89baa170000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000668a6bf4ffdd9bb38e50c40038cbc18ec2cbac48000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000040902f1ac00000000000000000000000000000000000000000000000000000000000000000000000000000000668a6bf4ffdd9bb38e50c40038cbc18ec2cbac480000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000418160ddd00000000000000000000000000000000000000000000000000000000\"},\"latest\"],\"id\":373118,\"jsonrpc\":\"2.0\"}`))

	tt := `{"id":"1","jsonrpc":"2.0","method":"chain_getHeader","params":[null]}`
	v := json.NewNull()
	if err := v.Decode([]byte(tt)); err != nil {
		log.Fatal(err)
	}

	_, p := v.ObjectVal([]byte("params"))
	log.Println(p.ArrayElem(0).Type() == json.Null)

	var data = `{"jsonrpc":"2.0","id":1.43,"error":{"code":-32602,"message":"invalid argument"}}`
	v = json.NewNull()
	if err := v.Decode([]byte(data)); err != nil {
		log.Fatal(err)
	}
	_, val1 := v.ObjectVal([]byte("id"))
	log.Println("value 1", val1.Int(), "----", val1.Type())

	data = `{"jsonrpc":"2.0","id":"ad","error":{"code":-32602,"message":"invalid argument"}}`
	v.Reset()
	if err := v.Decode([]byte(data)); err != nil {
		log.Fatal(err)
	}
	_, val2 := v.ObjectVal([]byte("id"))
	log.Println("value 1", val1.Int())
	log.Println("value 2", string(val2.String([]byte{})))

	/*grab()

	stdJson()*/
}

func grab() {
	log.Println("-----grab------")
	var data = `{"jsonrpc":"2.0","id":1,"error":{"code":-32602,"message":"invalid argument"}}`
	v := json.NewNull()
	if err := v.Decode([]byte(data)); err != nil {
		log.Fatal(err)
	}
	_, val1 := v.GrabObjectVal([]byte("id"))
	log.Println("value 1", val1.Int())

	data = `{"jsonrpc":"2.0","id":"ad","error":{"code":-32602,"message":"invalid argument"}}`
	v.Reset()
	if err := v.Decode([]byte(data)); err != nil {
		log.Fatal(err)
	}
	_, val2 := v.GrabObjectVal([]byte("id"))
	log.Println("value 1", val1.Int())
	log.Println("value 2", string(val2.String([]byte{})))
}

func stdJson() {
	log.Println("-----stdJson------")
	var data = `{"jsonrpc":"2.0","id":1,"error":{"code":-32602,"message":"invalid argument"}}`
	v := json.NewNull()
	if err := v.Decode([]byte(data)); err != nil {
		log.Fatal(err)
	}

	type S struct {
		Jsonrpc string      `json:"jsonrpc"`
		Id      interface{} `json:"id"`
		Error   interface{} `json:"error"`
	}

	s := new(S)
	_, id := v.ObjectVal([]byte("id"))
	s.Id = id.Int()
	_, s.Error = v.ObjectVal([]byte("error"))

	rs, err := stdjson.Marshal(s)
	if err != nil {
		log.Fatal(err)
	}
	log.Println("standard json", string(rs))
}
